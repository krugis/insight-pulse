# nginx/nginx.conf

# REMOVED: worker_processes directive
# REMOVED: events { ... } block
# REMOVED: http { ... } block itself

# This file will be included inside Nginx's main http {} block.
# So, we only define what goes inside a 'server' block or 'http' block directly.

server {
    listen 80; # Listen for HTTP traffic on port 80
    server_name localhost; # Replace with your domain name in production (e.g., yourdomain.com)

    # Root for serving static frontend files
    root /usr/share/nginx/html; # This path inside the container will contain your frontend files
    index index.html index.htm; # Default file to serve

    # Proxy API requests to the BFF service
    location /api/v1/ {
        proxy_pass http://bff_service/api/v1/; # Forward API requests to the BFF upstream
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_buffering off;
    }

    # Handle all other requests by trying to serve static files first
    location / {
        try_files $uri $uri/ /index.html; # For single-page applications, routes to index.html if file not found
    }

    # Optional: For HTTPS (highly recommended for production)
    # listen 443 ssl;
    # ssl_certificate /etc/nginx/certs/yourdomain.crt;
    # ssl_certificate_key /etc/nginx/certs/yourdomain.key;
    # include /etc/nginx/snippets/ssl-params.conf; # (You'd create this file)
}